<%- include('partials/header', { title: 'Dashboard' }) %>

<div class="container">
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="text-primary">
        <i class="fas fa-tachometer-alt me-2"></i>Welcome back, <%= user.name %>!
      </h2>
      <p class="text-muted">Manage your tasks and stay productive.</p>
    </div>
  </div>
  
  <%- include('partials/alerts') %>
  
  <!-- Task Stats -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">Total Tasks</h6>
              <h3><%= tasks.length %></h3>
            </div>
            <div class="align-self-center">
              <i class="fas fa-tasks fa-2x opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-success text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">Completed</h6>
              <h3><%= tasks.filter(t => t.completed).length %></h3>
            </div>
            <div class="align-self-center">
              <i class="fas fa-check-circle fa-2x opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-warning text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">Pending</h6>
              <h3><%= tasks.filter(t => !t.completed).length %></h3>
            </div>
            <div class="align-self-center">
              <i class="fas fa-clock fa-2x opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Task Form -->
  <div class="card mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0">
        <i class="fas fa-plus-circle me-2"></i>Add New Task
      </h5>
    </div>
    <div class="card-body">
      <form action="/tasks" method="POST">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="title" class="form-label">Task Title *</label>
            <input type="text" class="form-control" id="title" name="title" 
                   placeholder="Enter task title..." required>
          </div>
          <div class="col-md-3">
            <label for="priority" class="form-label">Priority</label>
            <select class="form-select" id="priority" name="priority">
              <option value="low">游릭 Low</option>
              <option value="medium" selected>游리 Medium</option>
              <option value="high">游댮 High</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="dueDate" class="form-label">Due Date</label>
            <input type="date" class="form-control" id="dueDate" name="dueDate">
          </div>
          <div class="col-12">
            <label for="description" class="form-label">Description (Optional)</label>
            <textarea class="form-control" id="description" name="description" 
                      rows="2" placeholder="Add task description..."></textarea>
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-plus me-2"></i>Add Task
            </button>
            <button type="reset" class="btn btn-outline-secondary ms-2">
              <i class="fas fa-eraser me-2"></i>Clear
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Tasks List -->
  <div class="card">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="fas fa-list me-2"></i>Your Tasks
      </h5>
      <span class="badge bg-primary"><%= tasks.length %> tasks</span>
    </div>
    <div class="card-body">
      <% if (tasks.length === 0) { %>
        <div class="text-center py-5">
          <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">No tasks yet</h5>
          <p class="text-muted">Add your first task above to get started!</p>
        </div>
      <% } else { %>
        <div class="list-group list-group-flush">
          <% tasks.forEach(task => { %>
            <div class="list-group-item <%= task.completed ? 'bg-light' : '' %>">
              <div class="d-flex justify-content-between align-items-center">
                <div class="flex-grow-1">
                  <h6 class="mb-1 <%= task.completed ? 'text-decoration-line-through text-muted' : '' %>">
                    <%= task.title %>
                  </h6>
                  <% if (task.description) { %>
                    <p class="mb-1 text-muted small"><%= task.description %></p>
                  <% } %>
                  <small class="text-muted">
                    <i class="fas fa-calendar-alt me-1"></i>
                    <%= new Date(task.createdAt).toLocaleDateString() %>
                    
                    <% if (task.dueDate) { %>
                      <span class="ms-2">
                        <i class="fas fa-clock me-1"></i>
                        Due: <%= new Date(task.dueDate).toLocaleDateString() %>
                      </span>
                    <% } %>
                    
                    <% if (task.completed) { %>
                      <span class="badge bg-success ms-2">
                        <i class="fas fa-check me-1"></i>Completed
                      </span>
                    <% } else { %>
                      <span class="badge bg-<%= 
                        task.priority === 'high' ? 'danger' : 
                        task.priority === 'medium' ? 'warning' : 'success'
                      %> ms-2">
                        <%= task.priority === 'high' ? '游댮' : task.priority === 'medium' ? '游리' : '游릭' %>
                        <%= task.priority.charAt(0).toUpperCase() + task.priority.slice(1) %>
                      </span>
                    <% } %>
                  </small>
                </div>
                <div class="btn-group" role="group">
                  <a href="/tasks/<%= task._id %>/edit" class="btn btn-outline-primary btn-sm" 
                     title="Edit task">
                    <i class="fas fa-edit"></i>
                  </a>
                  <form action="/tasks/<%= task._id %>/complete" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-outline-<%= task.completed ? 'warning' : 'success' %> btn-sm" 
                            title="<%= task.completed ? 'Mark as incomplete' : 'Mark as complete' %>">
                      <i class="fas <%= task.completed ? 'fa-undo' : 'fa-check' %>"></i>
                    </button>
                  </form>
                  <form action="/tasks/<%= task._id %>/delete" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-outline-danger btn-sm" 
                            title="Delete task" 
                            onclick="return confirm('Are you sure you want to delete this task?')">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </div>
              </div>
            </div>
          <% }); %>
        </div>
      <% } %>
    </div>
  </div>
</div>

<%- include('partials/footer') %>